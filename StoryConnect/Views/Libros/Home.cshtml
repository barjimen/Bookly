@model List<LibrosLeyendo>
@{
    var nombreUsuario = Context.Session.GetString("nombre");
    var idUsuario = Context.Session.GetInt32("id");
}
<div class="container-fluid" style="padding-top: 2rem!important; padding-bottom:6rem!important">
    <h1>Bienvenidx, @nombreUsuario</h1>
    <h2>Libros que estás leyendo</h2>
    <div style="background-color: antiquewhite;" class="d-flex flex-row bd-highlight gap-4">
        @if (Model.Count == 0)
        {
            <p>No tienes libros en lectura actualmente.</p>
        }
        else
        {
            @foreach (var libro in Model)
            {
                <div class="card" style="width: 18rem; margin-left: 15px;">
                    <img class="card-img-top" src="~/images/books/@libro.ImagenPortada" alt="Card image cap" style="height:auto; width:150px">
                    <div class="card-body">
                        <h1>@libro.Titulo</h1>
                        <p>
                            @libro.NombreAutor, @libro.FechaPublicacion
                        </p>
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton-@libro.Id" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Cambiar lista
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-@libro.Id">
                                <button class="dropdown-item mover-libro" data-idlibro="@libro.Id" data-destino="1" data-origen="@libro.IdLista">Leyendo</button>
                                <button class="dropdown-item mover-libro" data-idlibro="@libro.Id" data-destino="2" data-origen="@libro.IdLista">Leído</button>
                                <button class="dropdown-item mover-libro" data-idlibro="@libro.Id" data-destino="3" data-origen="@libro.IdLista">Próxima Lectura</button>
                            </div>

                        </div>
                    </div>
                </div>
            }
        }
    </div>
    <h2 style="background-color:cornflowerblue">
        Otros datos
    </h2>
</div>

<!-- Agregar jQuery y Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    $(document).ready(function () {
        $(".mover-libro").click(function () {
            var idlibro = $(this).data("idlibro");
            var destino = $(this).data("destino");
            var origen = $(this).data("origen");

            $.ajax({
                url: '@Url.Action("MoverLibrosEntreListas", "Libros")',
                type: 'POST',
                data: { idlibro: idlibro, destino: destino, origen: origen },
                success: function (response) {
                    alert("Libro movido exitosamente.");
                    location.reload(); // Recargar la página para actualizar la lista
                },
                error: function (xhr, status, error) {
                    alert("Error al mover el libro: " + xhr.responseText);
                }
            });
        });
    });
</script>